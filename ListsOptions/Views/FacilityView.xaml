<UserControl
    x:Class="ListsOptionsUI.Views.FacilityView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid Margin="20">
        <StackPanel>
            <!--  Текстово поле за въвеждане  -->
            <TextBox
                Width="280"
                Height="35"
                Padding="5"
                Background="White"
                BorderBrush="#4CAF50"
                BorderThickness="2"
                FontSize="14"
                Text="{Binding NewFacilityName, UpdateSourceTrigger=PropertyChanged}" />

            <!--  Бутон за добавяне  -->
            <Button
                Width="130"
                Height="40"
                Margin="0,10,0,10"
                Background="#4CAF50"
                BorderThickness="0"
                Command="{Binding AddFacilityCommand}"
                Content="➕ Добави"
                Cursor="Hand"
                FontWeight="Bold"
                Foreground="White" />

            <!--  Styled ListBox  -->
            <ListBox
                MaxHeight="350"
                Padding="5"
                Background="#F5F5F5"
                BorderThickness="0"
                ItemsSource="{Binding Facilities}">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border
                            Margin="5"
                            Padding="5"
                            Background="White"
                            BorderBrush="Gray"
                            BorderThickness="1"
                            CornerRadius="10">

                            <Grid Height="60">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <!--  Основен елемент с име (ТЕКСТЪТ ОСТАВА СТАБИЛЕН)  -->
                                <TextBlock
                                    x:Name="FacilityName"
                                    Grid.Column="0"
                                    Padding="10"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    FontWeight="Bold"
                                    RenderTransformOrigin="0.5,0.5"
                                    Text="{Binding Name}">
                                    <TextBlock.RenderTransform>
                                        <TranslateTransform x:Name="TextTransform" X="0" />
                                    </TextBlock.RenderTransform>
                                </TextBlock>

                                <!--  Бутон за изтриване (СЛЕДВАЩО ДВИЖЕНИЕ)  -->
                                <Button
                                    x:Name="DeleteButton"
                                    Grid.Column="1"
                                    Width="60"
                                    Height="40"
                                    Background="Red"
                                    BorderThickness="0"
                                    Command="{Binding DataContext.DeleteFacilityCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                    CommandParameter="{Binding}"
                                    Content="❌"
                                    Cursor="Hand"
                                    FontWeight="Bold"
                                    Foreground="White"
                                    Visibility="Collapsed">
                                    <Button.RenderTransform>
                                        <TranslateTransform x:Name="ButtonTransform" X="40" />
                                    </Button.RenderTransform>
                                </Button>

                                <!--  Анимации  -->
                                <Grid.Triggers>
                                    <!--  При кликване, бутонът идва отдясно  -->
                                    <EventTrigger RoutedEvent="UIElement.MouseLeftButtonDown">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <!--  Бутонът се появява и плъзга  -->
                                                <DoubleAnimation
                                                    Storyboard.TargetName="ButtonTransform"
                                                    Storyboard.TargetProperty="X"
                                                    To="0"
                                                    Duration="0:0:0.2" />
                                                <ObjectAnimationUsingKeyFrames Storyboard.TargetName="DeleteButton" Storyboard.TargetProperty="Visibility">
                                                    <DiscreteObjectKeyFrame KeyTime="0:0:0.0" Value="{x:Static Visibility.Visible}" />
                                                </ObjectAnimationUsingKeyFrames>

                                                <!--  Текстът леко се измества наляво  -->
                                                <DoubleAnimation
                                                    Storyboard.TargetName="TextTransform"
                                                    Storyboard.TargetProperty="X"
                                                    To="-10"
                                                    Duration="0:0:0.2" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>

                                    <!--  При клик другаде, бутонът изчезва  -->
                                    <EventTrigger RoutedEvent="UIElement.MouseRightButtonDown">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <!--  Бутонът се скрива  -->
                                                <DoubleAnimation
                                                    Storyboard.TargetName="ButtonTransform"
                                                    Storyboard.TargetProperty="X"
                                                    To="40"
                                                    Duration="0:0:0.2" />
                                                <ObjectAnimationUsingKeyFrames Storyboard.TargetName="DeleteButton" Storyboard.TargetProperty="Visibility">
                                                    <DiscreteObjectKeyFrame KeyTime="0:0:0.2" Value="{x:Static Visibility.Collapsed}" />
                                                </ObjectAnimationUsingKeyFrames>

                                                <!--  Текстът се връща на място  -->
                                                <DoubleAnimation
                                                    Storyboard.TargetName="TextTransform"
                                                    Storyboard.TargetProperty="X"
                                                    To="0"
                                                    Duration="0:0:0.2" />
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </Grid.Triggers>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </StackPanel>
    </Grid>
</UserControl>
